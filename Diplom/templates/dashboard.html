{% extends "base.html" %}
{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | Neofinance{% endblock %}
{% block content %}
<div class="container py-4">

    <h3 class="fw-bold text-primary-emphasis mb-4">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Neofinance</h3>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted">–ë–∞–ª–∞–Ω—Å</h6>
                    <h4 class="fw-bold text-primary">{{ balance }} ‚ÇΩ</h4>
                    <small class="text-muted">–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted">–î–æ—Ö–æ–¥—ã</h6>
                    <h4 class="fw-bold text-success">{{ incomes }} ‚ÇΩ</h4>
                    <small class="text-muted">–ó–∞ –ø–µ—Ä–∏–æ–¥</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="text-muted">–†–∞—Å—Ö–æ–¥—ã</h6>
                    <h4 class="fw-bold text-danger">{{ expenses }} ‚ÇΩ</h4>
                    <small class="text-muted">–ó–∞ –ø–µ—Ä–∏–æ–¥</small>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white fw-semibold fs-5">üßæ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</div>
        <div class="card-body">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td>{{ t.transaction_date }}</td>
                        <td>
                            <span class="badge bg-{{ 'success' if t.category.is_income else 'danger' }}">{{ t.category.name }}</span>
                        </td>
                        <td class="fw-medium {% if t.category.is_income %}text-success{% else %}text-danger{% endif %}">
                            {{ t.amount }} ‚ÇΩ
                        </td>
                        <td>{{ t.description or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white fw-semibold fs-5">üìà –ê–Ω–∞–ª–∏–∑ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
        <div class="card-body">
            <canvas id="balanceChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('balanceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.labels | tojson }},
            datasets: [
                {
                    label: '–î–æ—Ö–æ–¥—ã',
                    data: {{ chart_data.incomes | tojson }},
                    borderColor: 'rgba(25, 135, 84, 0.9)',
                    backgroundColor: 'rgba(25, 135, 84, 0.1)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: '–†–∞—Å—Ö–æ–¥—ã',
                    data: {{ chart_data.expenses | tojson }},
                    borderColor: 'rgba(220, 53, 69, 0.9)',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    ticks: {
                        callback: value => value + ' ‚ÇΩ'
                    }
                }
            }
        }
    });
</script>
{% endblock %}
