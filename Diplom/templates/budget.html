{% extends "base.html" %}
{% block title %}–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞{% endblock %}

{% block content %}
<div class="container py-4">
    <h3 class="text-success fw-bold mb-4">üìä –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞</h3>

    <form method="POST" action="{{ url_for('set_budget') }}" class="row g-3 shadow-sm p-4 bg-light rounded-3">
        <div class="col-md-6">
            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category_id" class="form-select" required>
                {% for c in categories %}
                <option value="{{ c.id }}">{{ c.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
            <label class="form-label">–°—É–º–º–∞ –Ω–∞ –º–µ—Å—è—Ü (‚ÇΩ)</label>
            <input type="number" step="0.01" name="limit" class="form-control" required>
        </div>
        <div class="col-12 text-end">
            <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏–º–∏—Ç</button>
        </div>
    </form>

    <hr class="my-4">

    <h5 class="mb-3">üìå –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã</h5>
    {% if budgets %}
    <div class="row g-3">
        {% for b in budgets %}
        {% set percent = (b.spent / b.amount * 100) if b.amount else 0 %}
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6 class="card-title">{{ b.category }}</h6>
                    <p class="card-text mb-2 text-muted">
                        –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: {{ "%.2f"|format(b.spent) }} ‚ÇΩ –∏–∑ {{ "%.2f"|format(b.amount) }} ‚ÇΩ
                        {% if b.exceeded %}
                        <span class="badge bg-danger ms-2">–ü—Ä–µ–≤—ã—à–µ–Ω</span>
                        {% endif %}
                    </p>
                    <div class="progress">
                        <div class="progress-bar {% if b.exceeded %}bg-danger{% else %}bg-success{% endif %}"
                             role="progressbar"
                             style="width: {{ percent if percent <= 100 else 100 }}%;"
                             aria-valuenow="{{ percent }}"
                             aria-valuemin="0"
                             aria-valuemax="100">
                            {{ percent|round(0) }}%
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-warning mt-3">‚õî –ü–æ–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞.</div>
    {% endif %}
</div>
{% endblock %}
